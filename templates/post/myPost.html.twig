{% extends 'base.html.twig' %}

{% block title %}EmprunteMonPoney - Annonces
{% endblock %}

{% block body %}

	{% block header %}
		{% include "smallHeader.html.twig" %}
	{% endblock %}

	{% block container %}

		<div
			class="container-lg">

			{# flash message #}
			{% for message in app.flashes('message') %}
				<div class="alert alert-success" role="alert">
					{{ message }}
				</div>
			{% endfor %}

			<h2 class="mt-20">Mes annonces</h2>

			<button type="button" class="btn btn-primary mt-2 mb-2">
				<a href="{{ path('add_post') }}" class="aWithoutStyle">Nouvelle annonce</a>
			</button>

			{% for post in posts %}

				{% if post.equid is not null %}
					<h4>
						{{ post.equid.name |capitalize }}
					</h4>
				{% endif %}
				<div class="d-lg-flex flex-row justify-content-between">

					<table class="table border">
						<tbody>
							{% if post.equid is not null and post.equid is defined %}
								<tr>
									<td scope="col" class="font-weight-bold">Catégorie de l'annonce</td>
									<td>{{ post.category |capitalize }}</td>
								</tr>
								<tr>
									<td scope="col" class="font-weight-bold">Cheval</td>
									<td>{{ post.equid.name |capitalize}}</td>
								</tr>
								<tr>
									<td scope="col" class="font-weight-bold">Date de création</td>
									<td>{{ post.createdAt |date("d/m/Y") }}</td>
								</tr>
								<tr>
									<td scope="col" class="font-weight-bold">Prix / mois</td>
									<td>{{ post.price }}
										€</td>
								</tr>
								<tr>
									<td scope="col" class="font-weight-bold">Active</td>
									<td>
										<div class="custom-control custom-switch">
											<input type="checkbox" class="custom-control-input" id="customSwitch1" {{ (post.active) ? 'checked' : '' }} data-id="{{ post.id }}">
											<label class="custom-control-label" for="customSwitch1"></label>
										</div>
									</td>
								</tr>
							{% endif %}
						</tbody>
					</table>


					{% if post is not null and post is defined %}
						<div class="ml-5">
							{% include "post/postCard.html.twig" %}
						</div>
					{% endif %}

				</div>


				{# post pictures #}
				<div>
					<h3>Photos</h3>

					{% for photo in post.photos %}
						<div>
							<figure>
								<img src="{{ asset('/uploads/' ~ photo.name ) }}" alt="photo" style="width:350px">
							</figure>
							<a href="{{ path('delete_picture', {id: photo.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ photo.id) }}">
								<i class="fas fa-times"></i>
								supprimer la photo</a>
						</div>
					{% endfor %}
				</div>

				<button type="button" class="btn btn-primary mt-2 mb-2">
					<a href="{{ path('edit_post', {id: post.id} )}}" class="aWithoutStyle">
						<i class="fas fa-pencil-alt"></i>
						Modifier</a>
				</button>

				<button type="button" class="btn btn-primary mt-2 mb-2">
					<a href="{{ path('delete_post', {id: post.id} )}}" class="aWithoutStyle" onclick="return confirm('Êtes-vous sûr.e de vouloir supprimer votre annonce ? Attention cela supprimera également le cheval qui y est associé.')">
						<i class="fas fa-times"></i>
						Supprimer</a>
				</button>

				<hr>

			{% endfor %}

			{% if is_granted("ROLE_PROPRIO") and horses is null %}
				<p class="alert alert-secondary">
					<i class="fas fa-exclamation-triangle text-danger"></i>
					Veuillez inscrire au moins un cheval avant de créer une annonce
				</p>
			{% endif %}

		</div>

	{% endblock %}
{% endblock %}

{% block javascripts %}
	<script src="{{ asset('js/myPost.js') }}"></script>
{% endblock %}
